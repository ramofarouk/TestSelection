var a,b;a=this,b=function(){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var o="data-result",l={resultsList:"autoComplete_results_list",result:"autoComplete_result",highlight:"autoComplete_highlighted"},u=function(t){return"string"==typeof t?document.querySelector(t):t()},c=function(t){return t.innerHTML=""},h=u,r=function(t){var e=document.createElement(t.element);return t.container&&(l.resultsList=t.container(e)||l.resultsList),e.setAttribute("id",l.resultsList),t.destination.insertAdjacentElement(t.position,e),e},d=function(t){return"<span class=".concat(l.highlight,">").concat(t,"</span>")},a=function(i,r,a){r.forEach(function(t,e){var n=document.createElement(a.element),s=r[e].value[t.key]||r[e].value;n.setAttribute(o,s),n.setAttribute("class",l.result),n.setAttribute("tabindex","1"),n.innerHTML=a.content?a.content(t,n):t.match||t,i.appendChild(n)})},f=function(t,n){var s=u(t),i=n.firstChild;document.onkeydown=function(t){var e=document.activeElement;switch(t.keyCode){case 38:e!==i&&e!==s?e.previousSibling.focus():e===i&&s.focus();break;case 40:e===s&&0<n.childNodes.length?i.focus():e!==n.lastChild&&e.nextSibling.focus()}}},m=c,v=function(n,s,i,r){var a=s.querySelectorAll(".".concat(l.result));Object.keys(a).forEach(function(e){["mousedown","keydown"].forEach(function(t){a[e].addEventListener(t,function(e){"mousedown"!==t&&13!==e.keyCode&&39!==e.keyCode||(i({event:e,query:u(n)instanceof HTMLInputElement?u(n).value:u(n).innerHTML,matches:r.matches,results:r.list.map(function(t){return t.value}),selection:r.list.find(function(t){return(t.value[t.key]||t.value)===e.target.closest(".".concat(l.result)).getAttribute(o)})}),c(s))})})})};return function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.selector=t.selector||"#autoComplete",this.data={src:function(){return"function"==typeof t.data.src?t.data.src():t.data.src},key:t.data.key,cache:void 0===t.data.cache||t.data.cache},this.searchEngine="loose"===t.searchEngine?"loose":"strict",this.threshold=t.threshold||0,this.debounce=t.debounce||0,this.resultsList=r({container:!(!t.resultsList||!t.resultsList.container)&&t.resultsList.container,destination:t.resultsList&&t.resultsList.destination?t.resultsList.destination:h(this.selector),position:t.resultsList&&t.resultsList.position?t.resultsList.position:"afterend",element:t.resultsList&&t.resultsList.element?t.resultsList.element:"ul"}),this.sort=t.sort||!1,this.placeHolder=t.placeHolder,this.maxResults=t.maxResults||5,this.resultItem={content:!(!t.resultItem||!t.resultItem.content)&&t.resultItem.content,element:t.resultItem&&t.resultItem.element?t.resultItem.element:"li"},this.noResults=t.noResults,this.highlight=t.highlight||!1,this.onSelection=t.onSelection,this.dataSrc,this.init()}var t,n,s;return t=e,(n=[{key:"search",value:function(t,e){var n=this.highlight,s=e.toLowerCase();if("loose"===this.searchEngine){t=t.replace(/ /g,"");for(var i=[],r=0,a=0;a<s.length;a++){var o=e[a];r<t.length&&s[a]===t[r]&&(o=n?d(o):o,r++),i.push(o)}return r===t.length&&i.join("")}if(s.includes(t))return t=new RegExp("".concat(t),"i").exec(e),n?e.replace(t,d(t)):e}},{key:"listMatchedResults",value:function(n){var u=this;return new Promise(function(t){var l=[];n.filter(function(n,s){var t=function(t){var e=u.search(u.inputValue,n[t]||n);e&&t?l.push({key:t,index:s,match:e,value:n}):e&&!t&&l.push({index:s,match:e,value:n})};if(u.data.key){var e=!0,i=!1,r=void 0;try{for(var a,o=u.data.key[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){t(a.value)}}catch(t){i=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw r}}}else t()});var e=u.sort?l.sort(u.sort).slice(0,u.maxResults):l.slice(0,u.maxResults);return a(u.resultsList,e,u.resultItem),f(u.selector,u.resultsList),t({matches:l.length,list:e})})}},{key:"ignite",value:function(){var r=this,a=this.selector,o=h(a),t=this.placeHolder,l=this.onSelection;t&&o.setAttribute("placeholder",t);var n,s,i,u=function(s){r.inputValue=o instanceof HTMLInputElement?o.value.toLowerCase():o.innerHTML.toLowerCase();var i=r.resultsList;m(i);r.inputValue.length>r.threshold&&r.inputValue.replace(/ /g,"").length&&r.listMatchedResults(r.dataSrc).then(function(t){var e,n;e=s,n=t,o.dispatchEvent(new CustomEvent("type",{bubbles:!0,detail:{event:e,query:r.inputValue,matches:n.matches,results:n.list},cancelable:!0})),0===t.list.length&&r.noResults?r.noResults():l&&v(a,i,l,t)})};o.addEventListener("keyup",(n=function(e){if(r.data.cache)u(e);else{var t=r.data.src();t instanceof Promise?t.then(function(t){r.dataSrc=t,u(e)}):(r.dataSrc=t,u(e))}},s=this.debounce,function(){var t=this,e=arguments;clearTimeout(i),i=setTimeout(function(){return n.apply(t,e)},s)}))}},{key:"init",value:function(){var e=this,t=this.data.src();t instanceof Promise?t.then(function(t){e.dataSrc=t,e.ignite()}):(this.dataSrc=t,this.ignite())}}])&&i(t.prototype,n),s&&i(t,s),e}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();
